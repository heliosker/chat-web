(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{99937:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return n(91297)}])},91297:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return k},default:function(){return C}});var s=n(85893),l=n(67294),o=n(42746),i=n(47491),r=n(72490),a=n(39395),c=n(91627),h=function(e){let{content:t}=e,[o,h]=(0,l.useState)({});return(0,l.useEffect)(()=>{n.e(166).then(n.bind(n,79166)).then(e=>h(e.default))}),(0,s.jsx)(i.D,{children:t,components:{code(e){let{node:t,inline:n,className:l,style:i,children:r,...c}=e,h=/language-(\w+)/.exec(l||"");return n?(0,s.jsxs)("code",{className:"font-semibold italic",...c,children:[r,(0,s.jsx)("span",{children:"123"})]}):(0,s.jsx)(a.Z,{children:String(r).replace(/\n$/,""),style:o,language:h?h[1]:"",PreTag:"div",...c})}},remarkPlugins:[r.Z],rehypePlugins:[c.Z]})},u=n(246),x=n.n(u);let d=e=>{let t=()=>{e.current&&e.current.scrollIntoView({behavior:"smooth",block:"end"})};return t};var p=n(86886),f=n(69661),_=n(90629),m=n(70787),g=n(83321),j=n(26307),Z=n(44745),w=n(13486),b=n(1375),y=n(88167),v=n.n(y),N=n(18377),P=n(6490),S=n(86501),k=!0;function C(e){let{user:t}=e,n=(0,l.useRef)(null);(0,o.useTranslations)("Index");let i=d(n),r=(0,P.Z)(),[a,c]=(0,l.useState)(""),[u,y]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1),[E,O]=(0,l.useState)([{role:"system",content:"You are a helpful assistant."}]);(0,l.useEffect)(()=>{i(),(0,S.ZP)("Hello World")},[i]);let D=e=>{c(e.target.value)},I=e=>{!1===e.shiftKey&&13===e.keyCode&&!1===u&&(c(""),e.preventDefault(),T(e))},T=async e=>{if(!t)return r.onOpen();if(e.preventDefault(),u||!a)return;E.push({role:"user",content:a},{role:"ai",content:""}),O(E),y(!0),i(),new AbortController;let n=0,s=E.filter(e=>"ai"!==e.role).slice(-5),l=[];C(!0),await (0,b.L)("https://api.helloadmin.cn/api/web/chat/completions",{method:"POST",body:JSON.stringify({prompt:a,messages:s,token:t.token}),headers:{"Content-Type":"application/json"},onmessage(e){"[DONE]"===e.data&&C(!1);let t=e.data;try{var s;let e=JSON.parse(t),o=(null===(s=e.choices[0].delta)||void 0===s?void 0:s.content)||"";if(l=[...l,o],O(e=>[...e.slice(0,-1),{content:l.join(""),role:"ai"}]),y(!1),i(),n<2&&(o.match(/\n/)||[]).length)return;n++}catch(e){}},onclose(){console.log("Connection closed by the server")}})},H=()=>{};return(0,s.jsxs)(N.Z,{className:v().chat_content,children:[(0,s.jsx)("div",{className:v().chat_list,children:(0,s.jsxs)(x(),{pageStart:0,loadMore:H,hasMore:!1,useWindow:!1,className:v().scroll_bottom,children:[(0,s.jsx)(p.ZP,{container:!0,direction:"row",alignItems:"center",justifyContent:"center",children:E.map((e,t)=>(0,s.jsx)(p.ZP,{item:!0,xs:12,children:(0,s.jsx)("div",{className:"user"===e.role?v().user_info:v().chat_ai,children:(0,s.jsxs)(p.ZP,{item:!0,xs:12,md:10,lg:8,sx:{display:"flex",py:{xs:2,sm:4},px:{xs:2},lineHeight:"30px"},children:[(0,s.jsx)(f.Z,{sx:{bgcolor:"user"===e.role?Z.Z[500]:w.Z[500],height:"30px",width:"30px",padding:"2px"},variant:"rounded",src:"user"===e.role?"":"/images/1.png"}),(0,s.jsx)(N.Z,{sx:{display:"flex",flexDirection:"column",width:"calc(100% - 120px)",paddingLeft:"20px",minHeight:"20px",lineHeight:"30px"},children:(0,s.jsx)("div",{className:"".concat(k&&t+1===E.length&&"animate-pulse result-streaming"),children:k&&t+1===E.length&&!e.content?(0,s.jsx)("p",{}):(0,s.jsx)(h,{content:e.content})})})]})})},t))}),(0,s.jsx)(N.Z,{sx:{height:"135px"},ref:n})]})}),(0,s.jsx)(N.Z,{sx:{position:"absolute",bottom:"2px",background:"#fff",p:{xs:"0x",sm:"40px 0px"},width:"100%"},children:(0,s.jsx)(p.ZP,{container:!0,direction:"row",alignItems:"center",justifyContent:"center",children:(0,s.jsx)(p.ZP,{item:!0,xs:12,md:10,lg:8,sx:{px:{xs:2}},children:(0,s.jsxs)(_.Z,{component:"form",sx:{widht:"100%",p:{xs:"6px 4px",sm:"10px 4px"},display:"flex",alignItems:"center"},children:[(0,s.jsx)(m.ZP,{multiline:!0,sx:{ml:1,flex:1},placeholder:"请输入内容",inputProps:{"aria-label":"search google maps"},value:a,onKeyDown:I,onChange:D}),(0,s.jsx)(g.Z,{onClick:e=>T(e),endIcon:(0,s.jsx)(j.Z,{sx:{color:"rgba(142,142,160, 0.4)"}})})]})})})})]})}},88167:function(e){e.exports={chat_content:"chat_chat_content__gEs0W",chat_list:"chat_chat_list__t2zHh",scroll_bottom:"chat_scroll_bottom__RjGpe",chat_ai:"chat_chat_ai__EzcwK",user_info:"chat_user_info__g8VMe"}}},function(e){e.O(0,[265,140,616,774,888,179],function(){return e(e.s=99937)}),_N_E=e.O()}]);